{% extends 'base.html' %}
{% load static %}

{% block breadcrumb-left %}
<div class="breadcrumb-container">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb breadcrumb-chevron">
      <li class="breadcrumb-item">
        <a href="{% url 'home' %}" class="text-decoration-none fw-bold">
          <i class="fas fa-home"></i> Home
        </a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        <i class="fas fa-graduation-cap"></i> Examination
      </li>
    </ol>
  </nav>
</div>
{% endblock breadcrumb-left %}

{% block title-icon %}fas fa-graduation-cap{% endblock title-icon %}

{% block title %}Examination Management{% endblock title %}

{% block subtitle %}Comprehensive examination management system{% endblock subtitle %}

{% block content %}
<div class="container-fluid exams-container">
  <!-- Dashboard Overview Cards -->
  <div class="row">
    <div class="col-md-3">
      <div class="card border-0 rounded-3 shadow-sm mb-4">
        <div class="card-body bg-primary bg-gradient text-white rounded-top">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h5 class="card-title mb-0 fw-bold">Upcoming Exams</h5>
              <h2 class="mt-2 mb-0 display-5 fw-bold">{{ upcoming_exams_count }}</h2>
            </div>
            <div class="rounded-circle bg-white bg-opacity-25 p-3">
              <i class="fas fa-calendar-alt fa-2x text-white"></i>
            </div>
          </div>
        </div>
        <div class="card-footer bg-white border-0 rounded-bottom">
          <a class="btn btn-primary btn-sm w-100" href="{% url 'exams:exam_list' %}">
            <i class="fas fa-eye me-1"></i> View Details
          </a>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card border-0 rounded-3 shadow-sm mb-4">
        <div class="card-body bg-success bg-gradient text-white rounded-top">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h5 class="card-title mb-0 fw-bold">Active Exams</h5>
              <h2 class="mt-2 mb-0 display-5 fw-bold">{{ active_exams_count }}</h2>
            </div>
            <div class="rounded-circle bg-white bg-opacity-25 p-3">
              <i class="fas fa-edit fa-2x text-white"></i>
            </div>
          </div>
        </div>
        <div class="card-footer bg-white border-0 rounded-bottom">
          <a class="btn btn-success btn-sm w-100" href="{% url 'exams:exam_list' %}">
            <i class="fas fa-eye me-1"></i> View Details
          </a>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card border-0 rounded-3 shadow-sm mb-4">
        <div class="card-body bg-warning bg-gradient text-white rounded-top">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h5 class="card-title mb-0 fw-bold">Pending Results</h5>
              <h2 class="mt-2 mb-0 display-5 fw-bold">{{ pending_results_count }}</h2>
            </div>
            <div class="rounded-circle bg-white bg-opacity-25 p-3">
              <i class="fas fa-hourglass-half fa-2x text-white"></i>
            </div>
          </div>
        </div>
        <div class="card-footer bg-white border-0 rounded-bottom">
          <a class="btn btn-warning btn-sm w-100 text-white" href="{% url 'exams:marks_entry' %}">
            <i class="fas fa-eye me-1"></i> View Details
          </a>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card border-0 rounded-3 shadow-sm mb-4">
        <div class="card-body bg-info bg-gradient text-white rounded-top">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h5 class="card-title mb-0 fw-bold">Published Results</h5>
              <h2 class="mt-2 mb-0 display-5 fw-bold">{{ published_results_count }}</h2>
            </div>
            <div class="rounded-circle bg-white bg-opacity-25 p-3">
              <i class="fas fa-check-circle fa-2x text-white"></i>
            </div>
          </div>
        </div>
        <div class="card-footer bg-white border-0 rounded-bottom">
          <a class="btn btn-info btn-sm w-100 text-white" href="{% url 'exams:results' %}">
            <i class="fas fa-eye me-1"></i> View Details
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="row mb-4">
    <div class="col-md-12">
      <div class="card border-0 rounded-3 shadow-sm">
        <div class="card-header bg-primary bg-gradient text-white rounded-top">
          <h5 class="mb-0 fw-bold"><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
        </div>
        <div class="card-body py-4">
          <div class="row g-3">
            <div class="col-md-3 col-sm-6">
              <a href="{% url 'exams:exam_create' %}" class="card h-100 border-0 shadow-sm text-decoration-none hover-lift">
                <div class="card-body text-center p-4">
                  <div class="rounded-circle bg-primary bg-opacity-10 p-3 d-inline-block mb-3">
                    <i class="fas fa-plus-circle fa-2x text-primary"></i>
                  </div>
                  <h5 class="fw-bold text-primary">Create Exam</h5>
                  <p class="text-muted mb-0">Add a new examination</p>
                </div>
              </a>
            </div>
            <div class="col-md-3 col-sm-6">
              <a href="{% url 'exams:exam_schedule_list' %}" class="card h-100 border-0 shadow-sm text-decoration-none hover-lift">
                <div class="card-body text-center p-4">
                  <div class="rounded-circle bg-success bg-opacity-10 p-3 d-inline-block mb-3">
                    <i class="fas fa-calendar-alt fa-2x text-success"></i>
                  </div>
                  <h5 class="fw-bold text-success">Exam Schedule</h5>
                  <p class="text-muted mb-0">Manage exam timetables</p>
                </div>
              </a>
            </div>
            <div class="col-md-3 col-sm-6">
              <a href="{% url 'exams:question_paper_list' %}" class="card h-100 border-0 shadow-sm text-decoration-none hover-lift">
                <div class="card-body text-center p-4">
                  <div class="rounded-circle bg-danger bg-opacity-10 p-3 d-inline-block mb-3">
                    <i class="fas fa-file-alt fa-2x text-danger"></i>
                  </div>
                  <h5 class="fw-bold text-danger">Question Papers</h5>
                  <p class="text-muted mb-0">Manage exam papers</p>
                </div>
              </a>
            </div>
            <div class="col-md-3 col-sm-6">
              <a href="{% url 'exams:admit_card_list' %}" class="card h-100 border-0 shadow-sm text-decoration-none hover-lift">
                <div class="card-body text-center p-4">
                  <div class="rounded-circle bg-warning bg-opacity-10 p-3 d-inline-block mb-3">
                    <i class="fas fa-id-card fa-2x text-warning"></i>
                  </div>
                  <h5 class="fw-bold text-warning">Admit Cards</h5>
                  <p class="text-muted mb-0">Generate student cards</p>
                </div>
              </a>
            </div>
            <div class="col-md-3 col-sm-6">
              <a href="{% url 'exams:marks_entry' %}" class="card h-100 border-0 shadow-sm text-decoration-none hover-lift">
                <div class="card-body text-center p-4">
                  <div class="rounded-circle bg-info bg-opacity-10 p-3 d-inline-block mb-3">
                    <i class="fas fa-clipboard-check fa-2x text-info"></i>
                  </div>
                  <h5 class="fw-bold text-info">Enter Marks</h5>
                  <p class="text-muted mb-0">Record exam scores</p>
                </div>
              </a>
            </div>
            <div class="col-md-3 col-sm-6">
              <a href="{% url 'exams:results' %}" class="card h-100 border-0 shadow-sm text-decoration-none hover-lift">
                <div class="card-body text-center p-4">
                  <div class="rounded-circle bg-primary bg-opacity-10 p-3 d-inline-block mb-3">
                    <i class="fas fa-chart-bar fa-2x text-primary"></i>
                  </div>
                  <h5 class="fw-bold text-primary">Results</h5>
                  <p class="text-muted mb-0">View & publish results</p>
                </div>
              </a>
            </div>
            <div class="col-md-3 col-sm-6">
              <a href="{% url 'exams:exam_type_list' %}" class="card h-100 border-0 shadow-sm text-decoration-none hover-lift">
                <div class="card-body text-center p-4">
                  <div class="rounded-circle bg-success bg-opacity-10 p-3 d-inline-block mb-3">
                    <i class="fas fa-list-alt fa-2x text-success"></i>
                  </div>
                  <h5 class="fw-bold text-success">Exam Types</h5>
                  <p class="text-muted mb-0">Manage exam categories</p>
                </div>
              </a>
            </div>
            <div class="col-md-3 col-sm-6">
              <a href="#" class="card h-100 border-0 shadow-sm text-decoration-none hover-lift">
                <div class="card-body text-center p-4">
                  <div class="rounded-circle bg-secondary bg-opacity-10 p-3 d-inline-block mb-3">
                    <i class="fas fa-cog fa-2x text-secondary"></i>
                  </div>
                  <h5 class="fw-bold text-secondary">Settings</h5>
                  <p class="text-muted mb-0">Configure exam module</p>
                </div>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Upcoming Exams and Recent Activities -->
  <div class="row">
    <!-- Upcoming Exams -->
    <div class="col-md-6">
      <div class="card border-0 rounded-3 shadow-sm mb-4">
        <div class="card-header bg-primary bg-gradient text-white rounded-top d-flex justify-content-between align-items-center">
          <h5 class="mb-0 fw-bold"><i class="fas fa-calendar me-2"></i>Upcoming Exams</h5>
          <a href="{% url 'exams:exam_list' %}" class="btn btn-sm btn-light">
            <i class="fas fa-external-link-alt me-1"></i> View All
          </a>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover table-striped mb-0">
              <thead class="table-light">
                <tr>
                  <th class="ps-3">S/N</th>
                  <th>Exam</th>
                  <th>Type</th>
                  <th>Date</th>
                  <th class="pe-3">Status</th>
                </tr>
              </thead>
              <tbody>
                {% for exam in upcoming_exams %}
                <tr>
                  <td class="ps-3">{{ forloop.counter }}</td>
                  <td>
                    <a href="{% url 'exams:exam_detail' exam.id %}" class="text-decoration-none fw-bold text-primary">
                      {{ exam.name }}
                    </a>
                  </td>
                  <td><span class="badge bg-secondary bg-opacity-10 text-secondary">{{ exam.exam_type.name }}</span></td>
                  <td>
                    <i class="far fa-calendar-alt me-1 text-muted"></i>
                    {{ exam.start_date|date:"d M" }} - {{ exam.end_date|date:"d M, Y" }}
                  </td>
                  <td class="pe-3">
                    <span class="badge bg-warning">{{ exam.get_status_display }}</span>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="5" class="text-center py-4">
                    <div class="d-flex flex-column align-items-center py-3">
                      <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                      <p class="text-muted mb-0">No upcoming exams scheduled</p>
                      <a href="{% url 'exams:exam_create' %}" class="btn btn-sm btn-primary mt-2">
                        <i class="fas fa-plus me-1"></i> Create Exam
                      </a>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Activities -->
    <div class="col-md-6">
      <div class="card border-0 rounded-3 shadow-sm mb-4">
        <div class="card-header bg-success bg-gradient text-white rounded-top">
          <h5 class="mb-0 fw-bold"><i class="fas fa-history me-2"></i>Recent Activities</h5>
        </div>
        <div class="card-body p-4">
          <div class="position-relative ps-4">
            <!-- Vertical timeline line -->
            <div class="position-absolute top-0 bottom-0 start-0 border-start border-2 border-light ms-2"></div>

            {% for activity in recent_activities %}
            <div class="d-flex mb-4 position-relative">
              <div class="position-absolute start-0 translate-middle-x mt-2">
                <div class="rounded-circle p-2 {% if activity.type == 'schedule' %}bg-primary{% elif activity.type == 'paper' %}bg-warning{% elif activity.type == 'mark' %}bg-success{% else %}bg-info{% endif %}">
                  <i class="fas fa-{% if activity.type == 'schedule' %}calendar-alt{% elif activity.type == 'paper' %}file-alt{% elif activity.type == 'mark' %}clipboard-check{% else %}bell{% endif %} text-white small"></i>
                </div>
              </div>
              <div class="ms-4 flex-grow-1">
                <div class="d-flex justify-content-between align-items-center mb-1">
                  <h6 class="mb-0 fw-bold">{{ activity.type|title }}</h6>
                  <small class="text-muted">{{ activity.date|date:"d M, h:i A" }}</small>
                </div>
                <p class="mb-0 text-secondary">{{ activity.message }}</p>
              </div>
            </div>
            {% empty %}
            <div class="d-flex mb-4 position-relative">
              <div class="position-absolute start-0 translate-middle-x mt-2">
                <div class="rounded-circle p-2 bg-primary">
                  <i class="fas fa-flag text-white small"></i>
                </div>
              </div>
              <div class="ms-4 flex-grow-1">
                <div class="d-flex justify-content-between align-items-center mb-1">
                  <h6 class="mb-0 fw-bold">Welcome</h6>
                  <small class="text-muted">Today</small>
                </div>
                <p class="mb-0 text-secondary">Welcome to the Examination Management System!</p>
              </div>
            </div>
            <div class="d-flex mb-0 position-relative">
              <div class="position-absolute start-0 translate-middle-x mt-2">
                <div class="rounded-circle p-2 bg-info">
                  <i class="fas fa-info text-white small"></i>
                </div>
              </div>
              <div class="ms-4 flex-grow-1">
                <div class="d-flex justify-content-between align-items-center mb-1">
                  <h6 class="mb-0 fw-bold">Getting Started</h6>
                  <small class="text-muted">Today</small>
                </div>
                <p class="mb-0 text-secondary">Start by creating an exam and setting up the schedule.</p>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Additional Dashboard Section: Exam Statistics -->
  <div class="row">
    <div class="col-md-12">
      <div class="card border-0 rounded-3 shadow-sm mb-4">
        <div class="card-header bg-info bg-gradient text-white rounded-top">
          <h5 class="mb-0 fw-bold"><i class="fas fa-chart-pie me-2"></i>Examination Statistics</h5>
        </div>
        <div class="card-body p-4">
          <div class="row g-4">
            <div class="col-md-3">
              <div class="card h-100 border-0 shadow-sm">
                <div class="card-body text-center">
                  <div class="rounded-circle bg-primary bg-opacity-10 p-3 d-inline-block mb-3">
                    <i class="fas fa-users fa-2x text-primary"></i>
                  </div>
                  <h3 class="fw-bold">0</h3>
                  <p class="text-muted mb-0">Total Students</p>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card h-100 border-0 shadow-sm">
                <div class="card-body text-center">
                  <div class="rounded-circle bg-success bg-opacity-10 p-3 d-inline-block mb-3">
                    <i class="fas fa-check-circle fa-2x text-success"></i>
                  </div>
                  <h3 class="fw-bold">0%</h3>
                  <p class="text-muted mb-0">Average Pass Rate</p>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card h-100 border-0 shadow-sm">
                <div class="card-body text-center">
                  <div class="rounded-circle bg-warning bg-opacity-10 p-3 d-inline-block mb-3">
                    <i class="fas fa-star fa-2x text-warning"></i>
                  </div>
                  <h3 class="fw-bold">0</h3>
                  <p class="text-muted mb-0">Top Performers</p>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card h-100 border-0 shadow-sm">
                <div class="card-body text-center">
                  <div class="rounded-circle bg-danger bg-opacity-10 p-3 d-inline-block mb-3">
                    <i class="fas fa-exclamation-triangle fa-2x text-danger"></i>
                  </div>
                  <h3 class="fw-bold">0</h3>
                  <p class="text-muted mb-0">Needs Improvement</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}

{% block morecss %}
<style>
  /* Custom hover effect for cards */
  .hover-lift {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .hover-lift:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1) !important;
  }

  /* Pulse animation for icons */
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }

  .card:hover .rounded-circle i {
    animation: pulse 1s infinite;
  }
</style>
{% endblock morecss %}

{% block morejs %}
<script>
  $(document).ready(function() {
    // Add smooth scrolling
    $('a[href*="#"]').on('click', function(e) {
      e.preventDefault();
      $('html, body').animate(
        {
          scrollTop: $($(this).attr('href')).offset().top - 100,
        },
        500,
        'linear'
      );
    });

    // Add tooltip initialization
    $('[data-bs-toggle="tooltip"]').tooltip();

    // Add counter animation for statistics
    $('.counter').each(function() {
      $(this).prop('Counter', 0).animate(
        {
          Counter: $(this).text()
        },
        {
          duration: 2000,
          easing: 'swing',
          step: function(now) {
            $(this).text(Math.ceil(now));
          }
        }
      );
    });
  });
</script>
{% endblock morejs %}
