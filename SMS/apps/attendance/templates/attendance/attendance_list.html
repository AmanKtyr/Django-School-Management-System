{% extends 'base.html' %}

{% block breadcrumb-left %}
<div class="container">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb bg-light p-3 rounded shadow-sm">
      <li class="breadcrumb-item">
        <a href="#" class="text-decoration-none text-primary fw-bold">
          <i class="bi bi-calendar-check"></i> Attendance
        </a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
    </ol>
  </nav>
</div>
{% endblock breadcrumb-left %}

{% block content %}
<div class="container mt-4">
        <!-- Attendance Stats -->
        <div class="row text-center mb-4">
            <div class="col-md-3">
                <div class="p-4 bg-primary text-white rounded shadow-sm">
                    <h5>Total Students</h5>
                    <p class="fw-bold fs-4">{{ total_students }}0</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="p-4 bg-success text-white rounded shadow-sm">
                    <h5>Present/Leave</h5>
                    <p class="fw-bold fs-4">{{ present_leave }}</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="p-4 bg-danger text-white rounded shadow-sm">
                    <h5>Absent</h5>
                    <p class="fw-bold fs-4">{{ absent }}</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="p-4 bg-info text-white rounded shadow-sm">
                    <h5>Class Teacher</h5>
                    <p class="fw-bold fs-4">{{ class_teacher }} A K</p>
                </div>
            </div>
        </div>

<div class="container my-4">
    <div class="d-flex justify-content-between align-items-center bg-white shadow-sm p-3 rounded-3">
        <!-- Class Selection -->
        <form method="GET" action="" class="d-flex align-items-center gap-3">
            <label for="class-select" class="fw-bold fs-5 text-dark mb-0">
                <i class="bi bi-ui-checks-grid text-primary"></i> Select Class: 
            </label>
            <select id="class-select" name="class_id" 
                class="form-select form-control-lg shadow-sm border-1 border-primary px-4 py-2 rounded-3 fw-bold text-dark"
                style="width: 225px; transition: 0.3s ease-in-out;"
                onchange="this.form.submit()">
                <option value="" class="fw-bold text-secondary">ğŸ“Œ Choose a Class</option>
                {% for class in classes %}
                <option value="{{ class.id }}" 
                    class="fw-bold text-dark" 
                    {% if class.id|stringformat:"s" == selected_class_id %}selected{% endif %}>
                    {{ class.name }}
                </option>
                {% endfor %}
            </select>
        </form>

        <!-- Current Date -->
        <div class="text-end fw-bold fs-5 text-primary">
            ğŸ“… <span id="current-date"></span>
        </div>
    </div>
</div>



        <!-- Student Attendance Table -->
        <div class="table-responsive">
            <table id="studenttable" class="table table-bordered table-hover" data-page-length='100'>
              <thead class="thead-dark">
        <tr>
            <th>S/N</th>
            <th>ğŸ‘¨â€ğŸ“ Student Name</th>
            <th>ğŸ†” Unique ID</th>
            <th>ğŸ‘¨â€ğŸ‘¦Father Name</th>
            <th>ğŸ“š Class/Section</th>
            <th>ğŸ“ Attendance</th>
            <th>ğŸ“„ Comment</th>
            {% comment %} <th>ğŸ“… Date</th> {% endcomment %}
        </tr>
    </thead>
    <tbody>
        {% for student in students %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td class="fw-bold text-primary">{{ student.fullname }}</td>
            <td>{{ student.registration_number }}</td>
            <td>{{ student.Father_name }}</td>
            <td class="fw-bold">{{ student.current_class }}</td>
            <td>
                <div class="btn-group attendance-buttons" data-student="{{ student.id }}">
                    <button type="button" class="btn btn-sm attendance-btn btn-outline-success" data-value="present">âœ” Present</button>
                    <button type="button" class="btn btn-sm attendance-btn btn-outline-warning" data-value="leave">âš  Leave</button>
                    <button type="button" class="btn btn-sm attendance-btn btn-outline-danger" data-value="absent">âŒ Absent</button>
                </div>
            </td>
            <td > <input type="text" class="form-control" placeholder="Leave a Comment If any"></td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>


       <!-- Submit Button Aligned to Right -->
<div class="d-flex justify-content-end">
    <button type="submit" class="btn btn-lg btn-primary mt-4 shadow-sm fw-bold px-4">
        âœ… Submit Attendance
    </button>
</div>




<!-- JavaScript for Attendance Selection -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $(".attendance-btn").click(function () {
            let studentId = $(this).closest(".attendance-buttons").data("student");
            let selectedValue = $(this).data("value");
            
            $(this).siblings().removeClass("active btn-success btn-warning btn-danger text-white");
            
            if (selectedValue === "present") {
                $(this).addClass("active btn-success text-white");
            } else if (selectedValue === "leave") {
                $(this).addClass("active btn-warning text-dark");
            } else {
                $(this).addClass("active btn-danger text-white");
            }
        });
    });
</script>

<!-- JavaScript for Dynamic Date -->
<script>
    document.getElementById("current-date").innerText = new Date().toLocaleDateString('en-GB', { 
        day: '2-digit', month: 'long', year: 'numeric' 
    });
</script>

{% endblock content %}


{% block morejs %}
<script>
  $('#studenttable').DataTable({
  });
</script>

{% endblock morejs %}
